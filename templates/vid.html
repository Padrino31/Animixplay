<!DOCTYPE html>
<html lang="en">

<head>
    <!-- existing code... -->
	<link rel="icon" type="image/x-icon"
        href="https://d1nxzqpcg2bym0.cloudfront.net/google_play/com.anime.flv/ec0213b8-f1d8-11e7-8b0a-7d62278fee98/128x128">
    <title>animeflv VideoPlayer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style type="text/css">
        body {
            background-color: #000;
        }

        .container {
            width: 100%;
            height: 100%;
        }

        video {
            width: 100%;
            height: 100%;
        }
    </style>
	
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jwplayer@8.25.0/jwplayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/jwplayer@8.25.0/jwplayer.min.js"></script>

</head>
<body>
<div class="container">
  <video id="player" controls>
    <source src="https://corsbypass.herokuapp.com/{{ m3u8 }}" type="application/x-mpegURL">
  </video>
</div>


<script>
 const source = 'https://corsbypass.herokuapp.com/{{ m3u8 }}';

document.addEventListener("DOMContentLoaded", () => {
  const defaultOptions = {
    title: '{{ title }}',
    playbackRateControls: true,
    aspectRatio: '16:9',
    autostart: false,
    displaytitle: true,
    stretching: 'uniform',
    hlshtml: true,
    hlsjsdefault: true,
    hlsjsConfig: {
      xhrSetup: function (xhr, url) {
        xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
      }
    }
  };

  const player = jwplayer('player');
  player.setup({
    file: source,
    ...defaultOptions
  });

  player.on('levelsChanged', function (event) {
    const availableQualities = event.levels.map((l) => l.label);

    defaultOptions.qualityLabel = {
      default: availableQualities[0],
      options: availableQualities,
      forced: true,
      onChange: (e) => updateQuality(e),
    };
    player.updateConfig(defaultOptions);
  });

  function updateQuality(newQuality) {
    const level = player.getQualityLevels().filter((l) => l.label === newQuality)[0];
    player.setCurrentQuality(level.index);
  }
});

</script>
</body>
</html>
